import{h as B,b as E,R as k,c as D}from"./domLabeler-ee6f6ee0.js";import{c as h,a as P,i as W,r as U}from"./util-518e0215.js";import{c as F,r as H,s as K,b as $}from"./extensionConfig-2f8020b2.js";import{E as _}from"./extension-df281c1a.js";import{v as L}from"./v4-c70744d4.js";import"./_commonjsHelpers-de833af9.js";let y=!1;const c=document.createElement("div");c.id="area-selector";c.style.position="fixed";c.style.borderRadius="8px";c.style.border="3px solid #818cf8";c.style.width="0px";c.style.height="0px";c.style.pointerEvents="none";c.style.left="-15px";c.style.zIndex="2147483646";const M=e=>{y=e},j=()=>y,Y=()=>{const e=document.getElementById("area-selector");if(e)return{width:e.offsetWidth,height:e.offsetHeight,top:e.getBoundingClientRect().top,left:e.getBoundingClientRect().left}},G=e=>{y&&(e.cursive_mouseover_listener=z(e),e.addEventListener("mouseover",e.cursive_mouseover_listener,!0),document.body.appendChild(c))},X=e=>{var t;y&&(e.removeEventListener("mouseover",e.cursive_mouseover_listener,!0),delete e._cursive_mousedownListener,(t=document.getElementById("area-selector"))==null||t.remove())},z=e=>function(t){const o=t==null?void 0:t.srcElement;if(o){const n=o.getBoundingClientRect(),i=e.getElementById("area-selector");o.tagName==="IFRAME"?i.style.display="none":(i.style.display="block",i.style.width=`${n.width+12}px`,i.style.height=`${n.height+12}px`,i.style.top=`${n.top-6}px`,i.style.left=`${n.left-6}px`,n.width===0&&n.height===0&&(i.style.left="-15px"))}};var Q=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};Q.SENTRY_RELEASE={id:"8ebd067505d2dd921f18e16e57e4049cae5349a2"};let p=null,u=null;const g=new k,f={};let I=!1;const J=e=>{if(!e)return null;const{hostname:t}=new URL(e),o=t.split(".");return o.slice(Math.max(o.length-2,0)).join(".")},N=()=>{try{return window.self!==window.top}catch{return!0}},A=()=>window.frameElement===null&&N(),V=()=>window.frameElement?window.frameElement.src:window.location.href,C=e=>e.split(/[?#]/)[0],v=(e,t,o,n,i=null)=>{i===null&&(i=L()),f[i]||(f[i]=0);const s=r=>{r.data.requestId!==i||(delete f[i],n(r.data))};t.addEventListener("message",s),t.setTimeout(()=>{window.removeEventListener("message",s),f[i]<3?(f[i]++,v({assignedId:i},window,o,n,i)):console.log("Two way post message not delivered",e)},2e3),o.postMessage({requestId:i,...e},"*")};A()&&window.addEventListener("message",e=>{if(e.data.assignedId){const t=e.data.assignedId;if(t===void 0||p!=null)return;p=t,e.data.requestId&&window.parent.postMessage({requestId:e.data.requestId},"*")}});const Z=()=>{const e=document.getElementsByTagName("iframe");for(let t=0;t<e.length;t++)if(!e[t].contentDocument&&!e[t].hasAttribute("data-com-scribehow-frame-id")){const n=L(),i=()=>{e[t].setAttribute("data-com-scribehow-frame-id",n)};v({assignId:n},window,e[t].contentWindow,i,n)}},q=async()=>new Promise((e,t)=>{chrome.runtime.sendMessage({messageType:"getIframePosition",location:C(V()),iframeId:p},o=>{chrome.runtime.lastError||!o?e({error:chrome.runtime.lastError||!0}):e(o)})}),O=async e=>{var o,n;window.location&&(e.url=window.location.href,e.domain=window.location.hostname,e.page_title=document.title);let t=e;if(A()){if((n=H((o=K(e.url))==null?void 0:o.pathname))!=null&&n.endsWith($.Recorder))return;const i=e.position;let{offset:s,url:r,domain:d,page_title:a,error:l}=await q();(!s||isNaN(s.top)||isNaN(s.left))&&(s={top:0,left:0});const m=window&&window.devicePixelRatio||1,w=l?i:{x:i.x+s.left*m,y:i.y+s.top*m};t={...e,position:w,...l?{}:{url:r,domain:d,page_title:a}}}chrome.runtime.sendMessage({messageType:"action",action:t})},ee=e=>function(t){var l,m;chrome.runtime.sendMessage({messageType:"trackNewRelicLog",name:"mouse_event_triggered",details:{x:t==null?void 0:t.x,y:t==null?void 0:t.y,nodeName:(l=t==null?void 0:t.target)==null?void 0:l.nodeName,baseURI:(m=t==null?void 0:t.target)==null?void 0:m.baseURI}});const o=Date.now(),n=window&&window.devicePixelRatio||1,i=R(e._cursive_parent);let s=null;if(t.target&&t.target.id==="crxjs-ext")return;try{s=D(t.target)}catch{console.log("Could not generate selector.")}let r={kind:h.MOUSE_ACTIONS.CLICK,position:{x:(t.clientX+i.left)*n,y:(t.clientY+i.top)*n},description:P(t.target),devicePixelRatio:n,target:{},target_selector:s,target_tag:t.target.tagName,target_text:(t.target.innerText||t.target.textContent||"").substring(0,2048),target_outer_html:t.target.outerHTML,button:h.BUTTON_FROM_NUMBER[t.button],direction:"click",click_count:1,count:1,timestamp:o};I&&(r={...r,domString:document.body.outerHTML});const d=j(),a=Y();if(d&&a){const w={x:(a.left+a.width/2)*n,y:(a.top+a.height/2)*n};r={...r,position:w,show_position_indicator:!1,area_selector_width:a.width,area_selector_height:a.height}}O(r)},te=e=>function(t){if(document.activeElement&&document.activeElement.type==="password")return;const o=Date.now(),{key:n,shiftKey:i,altKey:s,ctrlKey:r,metaKey:d}=t;if(!n||W(n))return;let a=null;try{a=D(t.target)}catch{console.log("Could not generate selector.")}O({kind:h.KEYBOARD_ACTIONS.PRESS,direction:h.KEY_DIRECTIONS.DOWN,modifiers:{shiftKey:i,altKey:s,ctrlKey:r,metaKey:d},target_selector:a,target_tag:t.target.tagName,target_outer_html:t.target.outerHTML,key:U(n),timestamp:o})},R=e=>{if(!e)return{top:0,left:0};const t=e.getBoundingClientRect(),o=R(e.ownerDocument._cursive_parent);return{top:t.top+o.top,left:t.left+o.left}},oe=()=>{u===null&&(u=new MutationObserver((e,t)=>{e.forEach(o=>{o.addedNodes.forEach(n=>{n.nodeName==="IFRAME"?b(n):ne(n)})})})),u.observe(document,{childList:!0,subtree:!0,attributes:!1})},ne=e=>{if(typeof e.getElementsByTagName=="function"){const t=e.getElementsByTagName("iframe");for(let o=0;o<t.length;o++)b(t[o])}},T=(e=!1,t)=>{if(t){se(t,e),e&&ie(t);for(const o of t.querySelectorAll("iframe"))try{const n=o.contentDocument||o.contentWindow.document;n&&(e?(n._cursive_parent=o,b(o)):delete o.onload,T(e,n))}catch(n){n instanceof DOMException||console.log(n)}}},b=e=>{e.onload=()=>{const t=e.contentDocument||e.contentWindow.document;if(t._cursive_parent=e,!t){const o=L();e.setAttribute("data-com-scribehow-frame-id",o),e.contentWindow.postMessage({assignedId:o},"*")}}},ie=e=>{G(e),e._cursive_mousedownListener=ee(e),e._cursive_keydownListener=te(),e.addEventListener("mousedown",e._cursive_mousedownListener,!0),e.addEventListener("keydown",e._cursive_keydownListener,!0)},se=(e,t)=>{e.removeEventListener("mousedown",e._cursive_mousedownListener,!0),e.removeEventListener("keydown",e._cursive_keydownListener,!0),delete e._cursive_mousedownListener,delete e._cursive_keydownListener,t||(X(e),delete e._cursive_parent)},S=(e,t)=>{T(!0,document),Z(),oe(),e&&(g.startAsync(document,t),window.addEventListener("load",()=>{g.start(document,t)})),I=!1,chrome.runtime.sendMessage({messageType:"requestFlags"},o=>{o&&"domString2023q3"in o&&(I=!0)})},x=()=>{T(!1,document),u!==null&&u.disconnect()},re=(e,t)=>{let o=null;e&&(o=document.querySelector(`iframe[data-com-scribehow-frame-id="${e}"]`));const n=C(t);if(o||(o=document.querySelector(`iframe[src*="${n}"]`)),!o){const i=J(n);o=document.querySelector(`iframe[src*="${i}"]`)}return o};chrome.runtime.onMessage.addListener(async(e,t,o)=>{if(e.messageType==="advanceLiveStep"&&window.postMessage("advanceLiveStep","*"),e.messageType==="extensionStatusChange"&&(e.status===_.PAUSED_RECORDING&&x(),e.status===_.RECORDING&&S(e.liveBlurEnabled,e.liveBlurSettings)),e.messageType==="startRecording"&&(M(e.areaSelectorRecording),e.omitStart||S(e.liveBlurEnabled,e.liveBlurSettings),o({host:window.location.hostname,href:window.location.href})),e.messageType==="endRecording"&&(g.stop(),x()),e.messageType==="getHost"&&o(window.location.hostname),e.messageType==="getIframePosition"){if(N())return;const n=re(e.iframeId,e.location),i=R(n);o({offset:i,url:window.location.href,domain:window.location.hostname,page_title:document.title})}e.messageType==="changeLiveBlurSettings"&&(e.liveBlurEnabled?g.startAsync(document,e.liveBlurSettings):g.stop()),e.messageType==="highlightElementWithId"&&B(e.data)});chrome.runtime.sendMessage({messageType:"contentScriptLoaded",currentHost:window.location.hostname,currentUrl:window.location.href},({recordingStatus:e,areaSelectorRecording:t,liveBlurEnabled:o,liveBlurSettings:n})=>{t&&M(!0),e===_.RECORDING&&S(o,n)});if(F){const e="Your project: 'Test Project'";window.onload=function(){const o=window.top.document.getElementById(E);frameElement.id===e&&window.document.body.appendChild(o)},window.onunload=function(){const o=window.document.getElementById(E);frameElement.id===e&&window.top.document.body.appendChild(o)},window.addEventListener("message",o=>{o&&o.data.type&&o.data.type==="GET_EXTENSION_ID"&&window.postMessage({type:"SET_EXTENSION_ID",extensionId:chrome.runtime.id})});const t=window.top.document.getElementById(E);frameElement.id===e&&window.document.body.appendChild(t)}export{J as getHostnameFromURL};
